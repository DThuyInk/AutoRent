<div class="breadcrumb">
    <a href="/dashboard">Dashboard</a> / <a href="/cars">Danh S√°ch Xe</a> / <strong>Th√™m Xe M·ªõi</strong>
</div>

<% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
    <div class="alert alert-danger"><%= errorMessage %></div>
<% } %>

<div class="form-container">
    <h2 style="color: #667eea; margin-bottom: 30px;">üöó Th√™m Xe M·ªõi</h2>

    <form method="POST" action="/cars" onsubmit="return validateCarForm();">
        <div class="form-row">
            <div class="form-group">
                <label for="brand">H√£ng Xe *</label>
                <input type="text" id="brand" name="brand" placeholder="VD: Toyota, BMW, Mercedes..." required>
            </div>

            <div class="form-group">
                <label for="model">M·∫´u Xe *</label>
                <input type="text" id="model" name="model" placeholder="VD: Camry, 3 Series..." required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="licensePlate">Bi·ªÉn S·ªë Xe *</label>
                <input type="text" id="licensePlate" name="licensePlate" placeholder="VD: 29-ABC-123" required>
            </div>

            <div class="form-group">
                <label for="year">NƒÉm S·∫£n Xu·∫•t *</label>
                <input type="number" id="year" name="year" min="1990" max="2030" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="color">M√†u S·∫Øc *</label>
                <input type="color" id="color" name="color" value="#000000" required style="height: 50px;">
            </div>

            <div class="form-group">
                <label for="pricePerDay">Gi√° Thu√™/Ng√†y (VND) *</label>
                <input type="number" id="pricePerDay" name="pricePerDay" min="0" step="1000" required>
            </div>
        </div>

        <div class="form-group">
            <label for="ownerId">Ch·ªß S·ªü H·ªØu (Owner) *</label>
            <% if (user && user.role === 'Owner') { %>
                <!-- Owner: show their own name as disabled -->
                <input type="text" id="ownerId" value="<%= user.name %> (<%= user.id %>)" disabled style="background-color: #f5f5f5;">
                <input type="hidden" name="ownerId" value="<%= user.id %>">
            <% } else { %>
                <!-- Admin: show dropdown -->
                <select id="ownerId" name="ownerId" required>
                    <option value="">-- Ch·ªçn Owner --</option>
                    <% if (typeof owners !== 'undefined' && owners) { %>
                        <% owners.forEach(owner => { %>
                            <option value="<%= owner.id %>"><%= owner.name %> (<%= owner.id %>)</option>
                        <% }); %>
                    <% } %>
                </select>
            <% } %>
        </div>

        <div class="btn-group">
            <button type="submit" class="btn btn-success">‚úì Th√™m Xe</button>
            <a href="/cars" class="btn btn-secondary">‚Üê H·ªßy</a>
        </div>
    </form>
</div>

<script>
function validateCarForm() {
    const brand = document.getElementById('brand').value.trim();
    const model = document.getElementById('model').value.trim();
    const licensePlate = document.getElementById('licensePlate').value.trim();
    const year = document.getElementById('year').value;
    const pricePerDay = document.getElementById('pricePerDay').value;
    const ownerId = document.getElementById('ownerId').value;

    if (!brand) {
        alert('‚ö†Ô∏è H√£ng xe kh√¥ng ƒë∆∞·ª£c r·ªóng!');
        return false;
    }

    if (!model) {
        alert('‚ö†Ô∏è M·∫´u xe kh√¥ng ƒë∆∞·ª£c r·ªóng!');
        return false;
    }

    if (!licensePlate) {
        alert('‚ö†Ô∏è Bi·ªÉn s·ªë xe kh√¥ng ƒë∆∞·ª£c r·ªóng!');
        return false;
    }

    if (!year || year < 1990 || year > 2030) {
        alert('‚ö†Ô∏è NƒÉm s·∫£n xu·∫•t kh√¥ng h·ª£p l·ªá!');
        return false;
    }

    if (!pricePerDay || pricePerDay <= 0) {
        alert('‚ö†Ô∏è Gi√° thu√™ ph·∫£i l·ªõn h∆°n 0!');
        return false;
    }

    if (!ownerId) {
        alert('‚ö†Ô∏è Vui l√≤ng ch·ªçn ch·ªß s·ªü h·ªØu!');
        return false;
    }

    return confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën th√™m xe n√†y?');
}
</script>
