<div class="breadcrumb">
    <a href="/dashboard">Dashboard</a> / <a href="/users">Danh Sách User</a> / <strong>Chỉnh Sửa User</strong>
</div>

<% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
    <div class="alert alert-danger"><%= errorMessage %></div>
<% } %>

<div class="form-container">
    <h2 style="color: #667eea; margin-bottom: 30px;">✏️ Chỉnh Sửa User</h2>

    <form method="POST" action="/users/<%= user.id %>" onsubmit="return validateUserForm();">
        <div class="form-group">
            <label for="id">User ID</label>
            <input type="text" id="id" value="<%= user.id %>" disabled style="background-color: #f5f5f5;">
            <small style="color: #999;">Không thể thay đổi</small>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="username">Tên Đăng Nhập *</label>
                <input type="text" id="username" name="username" value="<%= user.username %>" disabled style="background-color: #f5f5f5;">
                <small style="color: #999;">Không thể thay đổi</small>
            </div>

            <div class="form-group">
                <label for="password">Mật Khẩu *</label>
                <input type="password" id="password" name="password" placeholder="Để trống nếu không muốn thay đổi">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="name">Tên Đầy Đủ *</label>
                <input type="text" id="name" name="name" value="<%= user.name %>" required>
            </div>

            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="email" value="<%= user.email %>" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="phone">Số Điện Thoại *</label>
                <input type="text" id="phone" name="phone" value="<%= user.phone %>" required>
            </div>

            <div class="form-group">
                <label for="role">Vai Trò *</label>
                <select id="role" name="role" required>
                    <option value="User" <%= user.role === 'User' ? 'selected' : '' %>>User (Khách Hàng)</option>
                    <option value="Owner" <%= user.role === 'Owner' ? 'selected' : '' %>>Owner (Chủ Xe)</option>
                    <option value="Admin" <%= user.role === 'Admin' ? 'selected' : '' %>>Admin (Quản Trị Viên)</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="address">Địa Chỉ</label>
            <input type="text" id="address" name="address" value="<%= user.address || '' %>">
        </div>

        <div style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h4 style="color: #667eea; margin-bottom: 15px;">ℹ️ Thông Tin Hệ Thống</h4>
            <div class="form-row">
                <div class="form-group">
                    <label>Ngày Tạo</label>
                    <input type="text" value="<%= new Date(user.createdAt).toLocaleString('vi-VN') %>" disabled style="background-color: white;">
                </div>
                <div class="form-group">
                    <label>Cập Nhật Lúc</label>
                    <input type="text" value="<%= new Date(user.updatedAt).toLocaleString('vi-VN') %>" disabled style="background-color: white;">
                </div>
            </div>
        </div>

        <div class="btn-group">
            <button type="submit" class="btn btn-success">✓ Lưu Thay Đổi</button>
            <a href="/users/<%= user.id %>" class="btn btn-secondary">← Hủy</a>
        </div>
    </form>
</div>

<script>
function validateUserForm() {
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const phone = document.getElementById('phone').value.trim();

    if (!name) {
        alert('⚠️ Tên đầy đủ không được rỗng!');
        return false;
    }

    if (!email) {
        alert('⚠️ Email không được rỗng!');
        return false;
    }

    if (!phone) {
        alert('⚠️ Số điện thoại không được rỗng!');
        return false;
    }

    return confirm('Bạn chắc chắn muốn cập nhật thông tin user này?');
}
</script>
